<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pomodoro Timer</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Pomodoro Timer</h1>
  </header>

  <main>
    <!-- Mode Selection -->
    <section id="timer-controls">
      <label for="modeSelect">Mode:</label>
      <select id="modeSelect">
        <option value="pomodoro">Pomodoro</option>
        <option value="shortBreak">Short Break</option>
        <option value="longBreak">Long Break</option>
      </select>

      <!-- Duration Inputs -->
      <div id="duration-inputs">
        <label>Pomodoro (min):
          <input type="number" id="pomodoroInput" value="25" min="1">
        </label>
        <label>Short Break (min):
          <input type="number" id="shortBreakInput" value="5" min="1">
        </label>
        <label>Long Break (min):
          <input type="number" id="longBreakInput" value="15" min="1">
        </label>
      </div>
    </section>

    <!-- Timer Display -->
    <section id="timer-display">
      <h2 id="session">Pomodoro</h2>
      <div id="timer">25:00</div>
      <button id="startStop">Start</button>
      <button id="reset">Reset</button>
      <button id="toggleTheme">Dark Mode</button>
    </section>

    <!-- Task & To-Do Lists -->
    <section id="task-section">
      <h2>Task</h2>
      <input type="text" id="taskInput" placeholder="Enter your task">
      <ul id="taskList"></ul>

      <h2>To-Do List</h2>
      <input type="text" id="todoInput" placeholder="Add a to-do item">
      <button id="addTodo">Add</button>
      <ul id="todoList"></ul>
    </section>
  </main>

  <!-- Audio -->
  <audio id="alarm" src="alarm.mp3" preload="auto"></audio>

  <!-- JavaScript -->
  <script>
    // Timer logic
    let isRunning = false;
    let timer;
    let timeLeft = 0;
    let currentMode = 'pomodoro';

    const timerDisplay = document.getElementById('timer');
    const sessionDisplay = document.getElementById('session');
    const startStopBtn = document.getElementById('startStop');
    const resetBtn = document.getElementById('reset');
    const modeSelect = document.getElementById('modeSelect');
    const alarmSound = document.getElementById('alarm');

    function getTimeForMode(mode) {
      const pomodoro = parseInt(document.getElementById('pomodoroInput').value, 10) || 25;
      const shortBreak = parseInt(document.getElementById('shortBreakInput').value, 10) || 5;
      const longBreak = parseInt(document.getElementById('longBreakInput').value, 10) || 15;
      if (mode === 'pomodoro') return pomodoro * 60;
      if (mode === 'shortBreak') return shortBreak * 60;
      if (mode === 'longBreak') return longBreak * 60;
    }

    function updateDisplay() {
      const minutes = Math.floor(timeLeft / 60).toString().padStart(2, '0');
      const seconds = (timeLeft % 60).toString().padStart(2, '0');
      timerDisplay.textContent = `${minutes}:${seconds}`;
      sessionDisplay.textContent = currentMode === 'pomodoro'
        ? 'Pomodoro'
        : currentMode === 'shortBreak'
        ? 'Short Break'
        : 'Long Break';
    }

    function toggleTimer() {
      if (isRunning) {
        clearInterval(timer);
        startStopBtn.textContent = 'Start';
      } else {
        timer = setInterval(() => {
          timeLeft--;
          updateDisplay();
          if (timeLeft <= 0) {
            clearInterval(timer);
            alarmSound.play();
            notify(`${sessionDisplay.textContent} complete!`);
            isRunning = false;
            startStopBtn.textContent = 'Start';
          }
        }, 1000);
        startStopBtn.textContent = 'Pause';
      }
      isRunning = !isRunning;
    }

    function resetTimer() {
      clearInterval(timer);
      isRunning = false;
      startStopBtn.textContent = 'Start';
      currentMode = modeSelect.value;
      timeLeft = getTimeForMode(currentMode);
      updateDisplay();
    }

    modeSelect.addEventListener('change', () => {
      currentMode = modeSelect.value;
      resetTimer();
    });

    startStopBtn.addEventListener('click', toggleTimer);
    resetBtn.addEventListener('click', resetTimer);

    function notify(message) {
      if (Notification.permission === 'granted') {
        new Notification(message);
      } else if (Notification.permission !== 'denied') {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            new Notification(message);
          }
        });
      }
    }

    // Dark Mode Toggle
    const toggleThemeBtn = document.getElementById('toggleTheme');
    toggleThemeBtn.addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
    });

    // Task Management
    const taskInput = document.getElementById('taskInput');
    const taskList = document.getElementById('taskList');
    taskInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && taskInput.value.trim()) {
        const li = document.createElement('li');
        li.textContent = taskInput.value;
        li.addEventListener('click', () => li.remove());
        taskList.appendChild(li);
        taskInput.value = '';
      }
    });

    // To-Do List
    const todoInput = document.getElementById('todoInput');
    const todoList = document.getElementById('todoList');
    const addTodoBtn = document.getElementById('addTodo');

    addTodoBtn.addEventListener('click', () => {
      if (todoInput.value.trim()) {
        const li = document.createElement('li');
        li.textContent = todoInput.value;
        li.addEventListener('click', () => li.remove());
        todoList.appendChild(li);
        todoInput.value = '';
      }
    });

    // Init
    resetTimer();
    if ('Notification' in window && Notification.permission !== 'granted') {
      Notification.requestPermission();
    }

    // Optional: register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>

  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background-color: #fff;
      color: #000;
    }
    .dark-theme {
      background-color: #121212;
      color: #eee;
    }
    #timer {
      font-size: 4rem;
      margin: 1rem 0;
    }
    button {
      margin: 0.5rem;
      padding: 0.5rem 1rem;
    }
    input[type="number"], input[type="text"], select {
      margin: 0.25rem;
      padding: 0.25rem;
    }
    ul {
      list-style-type: none;
      padding-left: 0;
    }
    li {
      padding: 0.5rem;
      border-bottom: 1px solid #ccc;
      cursor: pointer;
    }
  </style>
</body>
</html>
